# 싱글톤 컨테이너

웹 어플리케이션의 특징 = 고객의 요청이 많다 ⇒ 객체를 생성해야한다.

순수 DI :  요청이 들어올때마다 새로운 객체를 생성 ⇒ 메모리 낭비 심하다.

해결방안 : 하나의 해당객체가 딱 1개 생성, 공유 =**싱글톤**

## 싱글톤 패턴

클래스 인스턴스가 1개만 생성되는 것을 보장하는 디자인 패턴

객체 인스턴스를 2개 이상 생성 못하도록 막는다.

1. static영역에 객체 instance를 미리 하나 생성해서 올려둔다.
2. 이 객체 인스턴스가 필요하면 오직 'getInstance()' 메서드로 조회 가능
3. 딱 1개의 인스턴스만 존재해야 하므로, 생성자를 private로 막아서 외부에서  ㅜㄷㅈ 키워드로 객체 인스턴스가 생성되는 것을 막는다. (외부에서 생성 못한다)==

**스프링 프레임 워크가 알아서 싱글톤으로 불러와준다.**

싱글톤은 문제점이 많다.

- 싱글톤 패턴을 구현하는 코드 자체가 많이 들어간다.
- 의존관계상 클라이언트가 구체 클래스에 의존한다. DIP를 위반한다.
- 클라이언트가 구체 클래스에 의존해서 OCP 원칙을 위반할 가능성이 높다.
- 테스트하기 어렵다.
- 내부 속성을 변경하거나 초기화 하기 어렵다.
- private 생성자로 자식 클래스를 만들기 어렵다.
- 결론적으로 유연성이 떨어진다.
- 안티패턴으로 불리기도 한다

⇒ 이 모든것 문제점을 스프링은 해결하면서 싱글톤으로 불러온다

### 싱글톤 컨테이너

스프링 컨테이너는 싱글톤 패턴 문제점 해결, 객체 인스턴스를 싱글톤 1개만 생성

스프링 컨테이너의 빈 객체를 미리 생성한다

즉 스프링 컨테이너 덕분에 고객의 요청이 올 때 마다 객체를 생성하는 것이 아니라 이미만들어진 객체를 공유 ⇒ 효율적 재사용

### 싱글톤 방식의 주의점

**무상태(stateless)**로 설계해야 한다!
- 특정 클라이언트에 의존적인 필드가 있으면 안된다.
- 특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안된다!
- 가급적 읽기만 가능해야 한다.
- 필드 대신에 자바에서 공유되지 않는, 지역변수, 파라미터, ThreadLocal 등을 사용해야 한다

### @Configuration과 싱글톤

configuration내 bean이 여러번 호출 되는 상황. 하지만 모든 객체는 같은 주소를 참조하고 있다.

어떻게 이것 이 가능 할까?

### @Configuration과 바이트 코드 조작

자바의 

@**Configuation**에 비밀이 있다!

저장 시 스프링 컨테이너 등록후 호출시 같은 객체 호출 ⇒객체에 xxxCGLIB가 붙으면서 상당히 복잡해진 것

CGLIB라는 바이트코드 조작 라이브러리 사용, AppConfig 클래스 상속받은 임의의 다른 클래스를 만들고, 그 다른 클래스를 스프링 빈으로 등록한 것이다

@Bean만 사용해도 스프링 빈으로 등록되지만, 싱글톤을 보장하지 않는다